<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Complete the Missing Word</title>
<style>
  body {
    font-family: Arial, sans-serif;
    direction: rtl;
    background-color: #f4f4f4;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  .container {
    max-width: 600px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  h1 {
    margin-bottom: 10px;
  }
  #english-sentence {
    font-size: 18px;
    color: #444;
    margin-bottom: 15px;
  }
  #hebrew-sentence {
    font-size: 24px;
    margin-bottom: 20px;
    min-height: 40px;
    letter-spacing: 1.5px;
  }
  #answer-input {
    font-size: 18px;
    padding: 10px;
    width: 70%;
    max-width: 350px;
    border: 2px solid #5e17eb;
    border-radius: 6px;
    outline: none;
  }
  #answer-input:focus {
    border-color: #8a47ff;
  }
  .image-container img {
    max-width: 300px;
    width: 100%;
    height: auto;
    margin: 20px auto;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  #feedback {
    margin-top: 15px;
    color: green;
    font-weight: bold;
    min-height: 24px;
  }
  #restart-btn {
    margin-top: 25px;
    padding: 12px 25px;
    font-size: 18px;
    background-color: #5e17eb;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: none;
  }
  #restart-btn:hover {
    background-color: #4712b2;
  }
  .underline {
    border-bottom: 2px solid #5e17eb;
    padding: 0 6px;
    margin: 0 4px;
  }
  #recordings-container {
    margin-top: 25px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Complete the Missing Word</h1>
  <div id="english-sentence"></div>
  <div id="hebrew-sentence"></div>
  <input type="text" id="answer-input" dir="ltr" placeholder="Type the missing word here" autocomplete="off" />
  <div id="feedback"></div>
  <div class="image-container">
    <img id="question-image" src="Pic1.PNG" alt="Image" />
  </div>
  <button id="restart-btn">Restart</button>
  <div id="recordings-container"></div>
</div>

<script>
const questions = [
  {
    english: "!Everything is ready! We're heading out",
    hebrewWords: ["הַכֹּל", "מוּכָן", "אֲנַחְנוּ", "יוֹצְאִים", "לַדֶּרֶךְ"],
    answers: ["הכל", "מוכן", "אנחנו", "יוצאים", "לדרך"],
    image: "Pic1.PNG" 
  },
  {
    english: "Yes! I’m ready!",
    hebrewWords:  ["כֵּן", "אֲנִי", "מוּכָנָה"],
    answers: ["כן", "אני", "מוכנה"],
    image: "Pic1.PNG"
  },
    {
    english: "!And I'm wearing a helmet",
    hebrewWords: ["וַאֲנִי", "עוֹטֶה", "קַסְדָּה"],
    answers: ["ואני", "עוטה", "קסדה"],
    image: "Pic1.PNG"
  },
   {
    english: "Very nice. Let’s remember to ride slowly and be careful on the way",
    hebrewWords: ["יָפֶה", "מְאוֹד", "נִזְכּוֹר", "לִרְכֹּב", "לְאַט", "וְלְהִיזָּהֵר", "בַּדֶּרֶךְ"],
    answers: ["יפה", "מאוד", "נזכור", "לרכב", "לאט", "ולהיזהר", "בדרך"],
    image: "Pic1.PNG"
  },
  {
    english: "Dad, look! A yellow flower!",
    hebrewWords: ["אַבָּא", "תִּרְאֶה", "פֶּרַח", "צָהוֹב"],
    answers: ["אבא", "תראה", "פרח", "צהוב"],
    image: "Pic1.PNG"
  },
  {
    english: "The whole forest is full of beautiful flowers",
    hebrewWords: ["כָּל", "הַיַּעַר", "מָלֵא", "בִּפְּרָחִים", "יָפִים"],
    answers: ["כל", "היער", "מלא", "בפרחים", "יפים"],
    image: "Pic1.PNG"
  },
  {
    english: "!I see a big tree",
    hebrewWords: ["אֲנִי", "רוֹאָה", "עֵץ", "גָּדוֹל"],
    answers: ["אני", "רואה", "עץ", "גדול"],
    image: "Pic1.PNG"
  },
  {
    english: "This tree is as tall as a tower!?",
    hebrewWords:  ["הָעֵץ", "הַזֶּה", "גָּבוֹהַּ", "כְּמוֹ", "מִגְדָּל"],
    answers: ["העץ", "הזה", "גבוה", "כמו", "מגדל"],
    image: "Pic1.PNG"
  },
  {
    english: "It’s nice that you’re looking around. That’s part of the fun",
    hebrewWords:["יָפֶה", "שֶׁאַתֶּם", "מִסְתַּכְּלִים", "מִסָּבִיב", "זֶה", "חֵלֶק", "מֵהַכֵּיף"],
    answers: ["יפה", "שאתם", "מסתכלים", "מסביב", "זה", "חלק", "מהכיף"],
    image: "Pic1.PNG"
  },
  {
    english: "Dad, where’s the river?",
    hebrewWords: ["אַבָּא", "אֵיפֹה", "הַנָּהָר"],
    answers: ["אבא", "איפה", "הנהר"],
    image: "Pic1.PNG"
  },
  {
    english: "One more kilometer and we’ll see it",
    hebrewWords: ["עוֹד", "קִילוֹמֶטֶר", "אֶחָד", "וְנִרְאֶה", "אוֹתוֹ"],
    answers: ["עוד", "קילומטר", "אחד", "ונראה", "אותו"],
    image: "Pic1.PNG"
  },
  {
    english: "I’m getting a little hungry. Are we taking a break soon?",
    hebrewWords: ["נִהְיֵיתִי", "רְעֵבָה", "אֲנַחְנוּ", "עוֹשִׂים", "הַפְסָקָה", "בְּקָרוֹב"],
    answers: ["נהייתי", "רעבה", "אנחנו", "עושים", "הפסקה", "בקרוב"],
    image: "Pic1.PNG"
  },
    {
    english: "Of course. We’ll sit in the shade and eat some fruits",
    hebrewWords: ["בְּוַודַּאי", "נֵשֵׁב", "בַּצֵּל", "וְנֹאכַל", "פֵּירוֹת"],
    answers: ["בוודאי", "נשב", "בצל", "ונאכל", "פירות"],
    image: "Pic1.PNG"
  },
  {
    english: "?What fruits did you bring",
    hebrewWords: ["אֵילוּ", "פֵּירוֹת", "הֵבֵאתָ"],
    answers: ["אילו", "פירות", "הבאת"],
    image: "Pic1.PNG"
  },
  {
    english: "Strawberries, melon, and kiwi",
    hebrewWords: ["תּוּתִים", "מֶלוֹן", "וְקִיוִוי"],
    answers: ["תותים", "מלון", "וקיווי"],
    image: "Pic1.PNG"
  },
  {
    english: "I love trips like these with the family",
    hebrewWords: ["אֲנִי", "אוֹהֶבֶת", "טִיּוּלִים", "כָּאֵלֶּה", "עִם", "הַמִּשְׁפָּחָה"],
    answers: ["אני", "אוהבת", "טיולים", "כאלה", "עם", "המשפחה"],
    image: "Pic1.PNG"
  },
  {
    english: "Me too, it’s a pity that Mom couldn’t join us today",
    hebrewWords:  ["גַּם", "אֲנִי", "חֲבָל", "שֶׁאִמָּא", "לֹא", "יָכְלָה", "לְהִצְטָרֵף", "אֵלֵינוּ", "הַיּוֹם"],
    answers: ["גם", "אני", "חבל", "שאמא", "לא", "יכלה", "להצטרף", "אלינו", "היום"],
    image: "Pic1.PNG"
  },
  // הוסיפי עוד משפטים לפי הצורך
];

let currentQuestionIndex = 0;
let currentWordIndex = 0;

const englishSentenceEl = document.getElementById("english-sentence");
const hebrewSentenceEl = document.getElementById("hebrew-sentence");
const answerInput = document.getElementById("answer-input");
const feedbackEl = document.getElementById("feedback");
const questionImage = document.getElementById("question-image");
const restartBtn = document.getElementById("restart-btn");
const recordingsContainer = document.getElementById("recordings-container");

let mediaRecorder;
let recordedChunks = [];

// מציג את המשפט עם קו תחתון במקום המילה שיש להקליד
function renderSentence() {
  const question = questions[currentQuestionIndex];
  englishSentenceEl.textContent = question.english;

 const words = question.hebrewWords.map((word, i) => {
  if (i === currentWordIndex) {
    return `<span class="underline">____</span>`; // ללא קווים
  } else {
    return word;
  }
}); 

  hebrewSentenceEl.innerHTML = words.join(" ");
  questionImage.src = question.image;
  feedbackEl.textContent = "";
  answerInput.value = "";
  answerInput.focus();
  recordingsContainer.innerHTML = ""; // מנקה הקלטות קודמות
}

// קורא את המשפט בקול בעברית, ואז מפעיל הקלטה
function speakSentence(sentence) {
  return new Promise((resolve) => {
    const utterance = new SpeechSynthesisUtterance(sentence);
    utterance.lang = 'he-IL';
    speechSynthesis.speak(utterance);
    utterance.onend = () => {
      resolve();
    };
  });
}

// מפעיל הקלטה של הקול
async function startRecording() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recordedChunks = [];
    mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.ondataavailable = e => {
      if(e.data.size > 0) {
        recordedChunks.push(e.data);
      }
    };

    mediaRecorder.onstop = () => {
      const blob = new Blob(recordedChunks, { type: 'audio/webm' });
      const audioURL = URL.createObjectURL(blob);
      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = audioURL;
      audio.style.marginTop = "10px";
      recordingsContainer.appendChild(audio);
    };

    mediaRecorder.start();

    // הקלטה ל-9 שניות, אפשר לשנות
    setTimeout(() => {
      mediaRecorder.stop();
    }, 9000);
  } catch(err) {
    console.error('Error accessing microphone:', err);
  }
}

function checkAnswer() {
  const userAnswer = answerInput.value.trim();
  const correctAnswer = questions[currentQuestionIndex].answers[currentWordIndex];

  if(userAnswer === correctAnswer) {
    feedbackEl.style.color = "green";
    feedbackEl.textContent = "Correct!";

    currentWordIndex++;

    if(currentWordIndex >= questions[currentQuestionIndex].answers.length){
      // משפט הושלם - קריינות + הקלטת המשתמש
      const fullSentence = questions[currentQuestionIndex].hebrewWords.join(" ");
      answerInput.disabled = true; // חוסם הקלדה בזמן קריינות והקלטה

      speakSentence(fullSentence).then(() => {
        return startRecording();
      }).then(() => {
        answerInput.disabled = false;
        currentQuestionIndex++;
        currentWordIndex = 0;

        if(currentQuestionIndex >= questions.length){
          englishSentenceEl.textContent = "Great job! You've finished all the sentences!";
          hebrewSentenceEl.textContent = "";
          questionImage.style.display = "none";
          answerInput.style.display = "none";
          feedbackEl.textContent = "";
          restartBtn.style.display = "inline-block";
          return;
        }
        renderSentence();
      });

    } else {
      renderSentence();
    }

  } else {
    feedbackEl.style.color = "red";
    feedbackEl.textContent = "Type the word";
  }
}

answerInput.addEventListener("input", function(){
  checkAnswer();
});

restartBtn.addEventListener("click", () => {
  currentQuestionIndex = 0;
  currentWordIndex = 0;
  questionImage.style.display = "block";
  answerInput.style.display = "inline-block";
  restartBtn.style.display = "none";
  renderSentence();
});

renderSentence();
</script>
</body>
</html>